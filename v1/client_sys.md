[Главная](README.md)
<br>
# Система клиента
client_sys.js
<br>
Дизайн: https://xd.adobe.com/view/a5b727e2-4f17-4ce2-6c0a-3d90fd6c9eb6-d386/grid

<br>

### Получение имени клиента

Для получения имени клиента необходимо отправить **`GET`** запрос на **`/api/client_name/:u_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cd6acd4ca9472beaa183775",
        "name": "Любовь Миланова"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор клиента<br>

<br>

###  Получение количества заказов клиента за прошлый месяц

Для получения количества заказов клиента за прошлый месяц необходимо отправить **`GET`** запрос на **`/api/client_prev_order_count/:c_id`**<br>

Пример ответа:<br>
```
[
    {
        "order": 4,
        "order_complete": 7,
        "order_pending": 12,
        "count": 23
    }
]
```

Параметры:<br>
**c_id*** - Идентификатор клиента<br>

<br>

###  Получение количества заказов клиента за текущий месяц

Для получения количества заказов клиента за текущий месяц необходимо отправить **`GET`** запрос на **`/api/client_cur_order_count/:c_id`**<br>

Пример ответа:<br>
```
[
    {
        "order": 4,
        "order_complete": 7,
        "order_pending": 12,
        "count": 23
    }
]
```

Параметры:<br>
**c_id*** - Идентификатор клиента<br>

<br>

### Получение списка заказов, статус "в ожидании" (так же для поиска)

Для получения списка заказов, статус "в ожидании" необходимо отправить **`GET`** запрос на **`/client_order_pending/:u_id/:brand/:model/:generation/:first_date/:second_date`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cd8279ecdfee493715d37de",
        "name": "Ford Focus 2014-2017",
        "get_date": "12.05.2019. 14:03",
        "status": "в ожидании",
        "count": 3,
        "c_m_flag": true
    },
    {
        "_id": "5cfd4edd631521e4d7b0fd8a",
        "name": "Ford Focus 2014-2017",
        "get_date": "09.06.2019. 18:24",
        "status": "в ожидании",
        "count": 1
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор клиента<br>
**brand*** - Марка автомобиля<br>
**model*** - Модель автомобиля<br>
**generation*** - Поколение автомобиля<br>
**first_date*** - Нижняя граница даты поиска<br>
**second_date*** - Верхняя граница даты поиска<br>

<br>

### Получение заказа, статус "в ожидании"

Для получения заказа, статус "в ожидании", необходимо отправить **`GET`** запрос на **`/api/client_id_order_pending/:id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cd8279ecdfee493715d37de",
        "status": "pending",
        "auto": {
            "Марка": "Ford",
            "Модель": "Focus",
            "Поколение": "2014-2017",
            "Сложность": 3,
            "Какая конструкция передних подлокотников?": "Прямая"
        },
        "list": {
            "Количество": 3,
            "Тип задней спинки": "60x40",
            "Дизайн": "Classic",
            "Основной цвет": "Бежевый (Крем)",
            "Цвет боковых поддержек": "Белый",
            "Цвет декоративной отстрочки": "Серый 1615",
            "Материал центральной вставки": "Жаккард",
            "Цвет центральной вставкии": "Бежево-серый",
            "Вышивка логотипа": "нет",
            "Цвет логотипа": "нет",
            "Отстрочка центральной части": "Соты 45",
            "Цвет отстрочки центральной части": "Синий 575",
            "Комментарий": "Небольшое описание заказа"
        },
        "mc_message": {
            "m_m_flag": false,
            "c_m_flag": false,
            "message": [
                {
                    "mc_m_id": "5ce1c950ab9d9ce84d23c147",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "manager",
                    "message": "Какая точная комплектация вашего автомобиля?"
                },
                {
                    "mc_m_id": "5ce1cc17ab9d9ce84d23c148",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "client",
                    "message": "Комплектация Sport"
                },
                {
                    "mc_m_id": "5ce1cce7ab9d9ce84d23c149",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "manager",
                    "message": "Спасибо! Отдаю в работу!"
                }
            ]
        },
        "c_id": "5cd6acd4ca9472beaa183775",
        "date": "2019-05-12T14:03:10.056Z"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>

<br>

### Получение списка заказов, статус "в работе" (так же для поиска)

Для получения списка заказов, статус "в работе" необходимо отправить **`GET`** запрос на **`/api/client_order_active/:u_id/:brand/:model/:generation/:date_filter/:first_date/:second_date`**<br>

Пример ответа:<br>
```
[
     {
        "_id": "5cee18c1a0150d178c0a9317",
        "name": "Ford Focus 2014-2017",
        "start_date": "29.05.2019. 05:30",
        "get_date": "29.05.2019. 05:29",
        "count": 12,
        "status": "в работе"
    },
    {
        "_id": "5ced68c35fb188a6d2cfe500",
        "name": "Ford Focus 2014-2017",
        "start_date": "28.05.2019. 16:58",
        "get_date": "28.05.2019. 16:58",
        "count": 10,
        "status": "в работе"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор клиента<br>
**brand*** - Марка автомобиля<br>
**model*** - Модель автомобиля<br>
**generation*** - Поколение автомобиля<br>
**date_filter*** - Спискок по степени готовности заказа (Поступление ('get_date'), Передача в работу ('start_date'))<br>
**first_date*** - Нижняя граница даты поиска<br>
**second_date*** - Верхняя граница даты поиска<br>

<br>

### Получение заказа, статус "в работе"

Для получения заказа, статус "в работе", необходимо отправить **`GET`** запрос на **`/api/client_id_order_active/:id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5ced68c35fb188a6d2cfe500",
        "name": "Ford Focus 2014-2017",
        "start_date": "2019.05.28 16:58:56:680",
        "count": "10",
        "client": "Любовь Миланова",
        "stream": "Комплект авточехлов",
        "auto": {
            "Марка": "Ford",
            "Модель": "Focus",
            "Поколение": "2014-2017",
            "Сложность": "3",
            "Какая конструкция передних подлокотников?": "Прямая"
        },
        "list": {
            "Количество": "10",
            "Тип задней спинки": "60x40",
            "Дизайн": "Classic",
            "Основной цвет": "Бежевый (Крем)",
            "Цвет боковых поддержек": "Белый",
            "Цвет декоративной отстрочки": "Серый 1615",
            "Материал центральной вставки": "Жаккард",
            "Цвет центральной вставкии": "Бежево-серый",
            "Вышивка логотипа": "нет",
            "Цвет логотипа": "нет",
            "Отстрочка центральной части": "Соты 45",
            "Цвет отстрочки центральной части": "Синий 575",
            "Комментарий": "Небольшое описание заказа"
        },
        "get_date": "2019.05.28 16:58:43:278"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>

<br>

### Получение списка заказов, статус "выполнен" (так же для поиска)

Для получения списка заказов, статус "выполнен" необходимо отправить **`GET`** запрос на **`/api/client_order_complete/:u_id/:_id/:brand/:model/:generation/:date_filter/:first_date/:second_date`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cee18c1a0150d178c0a9317",
        "name": "Ford Focus 2014-2017",
        "get_date": "29.05.2019 05:29",
        "start_date": "29.05.2019 05:30",
        "finish_date": "23.06.2019 08:00",
        "count": "12",
        "sub_order": [
            {
                "_id": "5cee1907a0150d178c0a9321",
                "name": "Ford Focus 2014-2017",
                "get_date": "29.05.2019 05:29",
                "start_date": "29.05.2019 05:30",
                "finish_date": "23.06.2019 08:00"
            },
            {
                "_id": "5cee1906a0150d178c0a931d",
                "name": "Ford Focus 2014-2017",
                "get_date": "29.05.2019 05:29",
                "start_date": "29.05.2019 05:30",
                "finish_date": "23.06.2019 08:01"
            }
        ],
        "progress": "выполнен на33%"
    },
    {
        "_id": "5d0b942458300513831334bf",
        "name": "Ford Focus 2014-2017",
        "get_date": "20.06.2019 14:11",
        "start_date": "20.06.2019 20:36",
        "finish_date": "20.06.2019 20:36",
        "status": "выполнен"
    },
    {
        "_id": "5cfa1e8830500267c139e7ab",
        "name": "Ford Focus 2014-2017",
        "get_date": "07.06.2019 08:21",
        "start_date": "07.06.2019 08:22",
        "finish_date": "07.06.2019 08:22",
        "count": "1",
        "status": "выполнен"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор клиента<br>
**_id*** - Идентификатор заказа<br>
**brand*** - Марка автомобиля<br>
**model*** - Модель автомобиля<br>
**generation*** - Поколение автомобиля<br>
**date_filter*** - Спискок по степени готовности заказа (Поступление ('get_date'), Передача в работу ('start_date'), Выполнен ('finish_date'))<br>
**first_date*** - Нижняя граница даты поиска<br>
**second_date*** - Верхняя граница даты поиска<br>

<br>

### Получение заказа, статус "выполнен"

Для получения заказа, статус "выполнен", необходимо отправить **`GET`** запрос на **`/api/client_id_order_complete/:id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cfa74e0000bf58b520fca7a",
        "status": "active",
        "auto": {
            "Марка": "Ford",
            "Модель": "Focus",
            "Поколение": "2014-2017",
            "Сложность": "3",
            "Какая конструкция передних подлокотников?": "Прямая"
        },
        "list": {
            "Дизайн": "Classic",
            "Индивидуальный дизайн": "Да",
            "Основной материал": "Экозамша",
            "Основной материал цвет": "Красный",
            "Материал боковых поддержек": "Экозамша",
            "Материал боковых поддержек цвет": "Красный",
            "Материал центральной вставки": "Экозамша",
            "Материал центральной вставки цвет": "Красный",
            "Цвет декоративной отстрочки": "Красный",
            "Место вышивки логотипа": "На подголовнике",
            "Логотип цвет": "На подголовнике",
            "Нестандартный логотип": "Да",
            "Стёжка центральной части": "Анаконда",
            "Стёжка центральной части цвет": "Да",
            "Комплектность": "Задний подголовник",
            "Количество": 2,
            "Комментарий": "Небольшое описание заказа"
        },
        "c_id": "5cd6acd4ca9472beaa183775",
        "get_date": "2019.06.07 14:29:52:547",
        "start_date": "2019.06.07 14:30:23:689",
        "finish_date": "2019.05.21 19:35:42:263"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>

<br>

### Содание нового заказа

Для создания нового заказа необходимо отправить **`POST`** запрос на **`/api/order_pending`**<br>

Пример отправки параметров:<br>
```
{
    "status": "pending",
    "auto":
    {
      "Марка": "Ford",
      "Модель": "Focus",
      "Поколение": "2014-2017",
      "Сложность": "3",
      "Какая конструкция передних подлокотников?": "Прямая"
    },
    "list":
    {
      "Дизайн": "Classic",
      "Индивидуальный дизайн": "Да",
      "Основной материал": "Экозамша",
      "Основной материал цвет": "Красный",
      "Материал боковых поддержек": "Экозамша",
      "Материал боковых поддержек цвет": "Красный",
      "Материал центральной вставки": "Экозамша",
      "Материал центральной вставки цвет": "Красный",
      "Цвет декоративной отстрочки": "Красный",
      "Место вышивки логотипа": "На подголовнике",
      "Логотип цвет": "На подголовнике",
      "Нестандартный логотип": "Да",
      "Стёжка центральной части": "Анаконда",
      "Стёжка центральной части цвет": "Да",
      "Комплектность": "Задний подголовник",
      "Количество": 6,
      "Комментарий": "Небольшое описание заказа"
    },
    "price": 6780.59,
    "c_id": "5cd6acd4ca9472beaa183775"
}
```

Параметры:<br>
**status*** - Статус заказа: в ожидании (pending)<br>
**auto*** - Результаты тестирования из модельной карты<br>
**list*** - Выбор материалов и комментарии<br>
**c_id*** - id клиента для которого создаётся заказ<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Удаление заказа, статус "в ожидании"

Для создания нового заказа необходимо отправить **`DELETE`** запрос на **`/api/order_pending/:id`**<br>

Параметры:<br>
**id*** - Идентификатор заказа<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Получение материалов

Для получения списка материалов необходимо отправить **`GET`** запрос на **`/api/order_material/:g_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cec12afea6a07452959d1ee",
        "name": "Экозамша"
    },
    {
        "_id": "5cf812f7eb03a9ed4acd8e2b",
        "name": "Жаккард"
    }
]
```

Параметры:<br>
**g_id*** - Идентификатор группы материалов<br>

5cf6e1414060b2b7a11a30ac - Идентификатор группы ткани<br>
5cf6e1554060b2b7a11a30ad - Идентификатор группы нитки

<br>

### Получение цветов материала

Для получения цветов материала необходимо отправить **`GET`** запрос на **`/order_color/:id`**<br>

Пример ответа:<br>
```
[
    {
        "c_id": "5cf8126062eb21ed4ac7968e",
        "name": "Бордовый",
        "quantity": 36
    },
    {
        "c_id": "5cf8128262eb21ed4ac7968f",
        "name": "Синий",
        "quantity": 32
    },
    {
        "c_id": "5cf812ca62eb21ed4ac79690",
        "name": "Коричневый",
        "quantity": 60
    }
]
```

Параметры:<br>
**id*** - Идентификатор материала<br>

<br>

### Получение данных из справочника

Для получения данных из справочника необходимо отправить **`GET`** запрос на **`/order_deskbook/:id`**<br>

Пример ответа:<br>
```
[
    {
        "name": "Classic"
    },
    {
        "name": "Classic +"
    },
    {
        "name": "Dynamic"
    }
]
```

Параметры:<br>
**id*** - Идентификатор справочника<br>

5cfd7beef142a74ad523ae88 - Идентификатор "дизайна"<br>
5cfd7f6af142a74ad523ae8a - Идентификатор "цветов" для "Цвет декоративной отстрочки" и "Стёжка" "Цвет"<br>
5cfd7efef142a74ad523ae89 - Идентификатор "места вышивки логотипа"<br>
5cfd7fb7f142a74ad523ae8b - Идентификатор "стёжки"<br>

<br>

### Получение комплектаций из справочника

Для получения комплектаций из справочника необходимо отправить **`GET`** запрос на **`/order_equipment/:c_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5d892030b08dd438247ade4b",
        "name": "Комплектность",
        "value": [
            {
                "v_id": "5d89208db08dd438247ade4d",
                "name": "5 мест",
                "argument": {
                    "price": 4900
                }
            },
            {
                "v_id": "5d892096b08dd438247ade4e",
                "name": "2 места",
                "argument": {
                    "price": 2500
                }
            },
            {
                "v_id": "5d89dffcea075717685c8c4d",
                "name": "7 мест",
                "argument": {
                    "price": 7690
                }
            },
            {
                "v_id": "5d99e0398ab82b1ea41bdee5",
                "name": "Передняя сидушка",
                "argument": {
                    "price": 600
                }
            },
            {
                "v_id": "5d99e04f8ab82b1ea41bdee6",
                "name": "Передняя спинка",
                "argument": {
                    "price": 900
                }
            }
        ],
        "count": 21
    }
]
```

Параметры:<br>
**c_id*** - Идентификатор клиента<br>

<br>

### Получение типов логотипов из справочника

Для получения типов логотипов из справочника необходимо отправить **`GET`** запрос на **`/order_logo/:c_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5d99fb98fff5161662dfda32",
        "name": "Тип логотипа",
        "value": [
            {
                "name": "Cтандартный логотип",
                "argument": {
                    "price": 550
                }
            },
            {
                "name": "Нестандартный логотип",
                "argument": {
                    "price": 1050
                }
            },
            {
                "name": "Индивидуальный рисунок",
                "argument": {
                    "price": 1550
                }
            }
        ]
    }
]
```

Параметры:<br>
**c_id*** - Идентификатор клиента<br>

<br>

### Получение переписки менеджера - клиента для заказа

Для получения переписки необходимо отправить **`GET`** запрос на **`/order_message/:id/:status/:who`**<br>

Пример ответа:<br>
```
[
    {
        "mc_m_id": "5ce1c950ab9d9ce84d23c147",
        "who": "manager",
        "message": "Какая точная комплектация вашего автомобиля?",
        "date": "2019.05.12 14:03:10"
    },
    {
        "mc_m_id": "5ce1cc17ab9d9ce84d23c148",
        "who": "client",
        "message": "Комплектация Sport",
        "date": "2019.05.12 14:03:10"
    },
    {
        "mc_m_id": "5ce1cce7ab9d9ce84d23c149",
        "who": "manager",
        "message": "Спасибо! Отдаю в работу!",
        "date": "2019.05.12 14:03:10"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>
**status*** - Cтатус заказа (pending, active, canceled, complete)<br>
**who*** - От кого сообщение (client, manager), нужен для того, что бы мы понимали кто смотрит переписку, и для кого обновляем статус просмотренных сообщений 'm_m_flag' и 'c_m_flag'<br>

<br>

### Создание нового cообщения менеджера - клиента для заказа

Для создания нового заказа необходимо отправить **`POST`** запрос на **`/api/order_message`**<br>

Пример отправки параметров:<br>
```
{
    "id": "5cd8279ecdfee493715d37de",
    "status": "pending",
    "who": "client",
    "message": "Тестовое сообщение2888"
}
```

Параметры:<br>
**id*** - Идентификатор заказа<br>
**status*** - Cтатус заказа (pending, active, canceled, complete)<br>
**who*** - От кого сообщение (client, manager)<br>
**message*** - Текст сообщения<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Получение списка счетов

Для получения списка счетов необходимо отправить **`GET`** запрос на **`/api/invoices_client/:c_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5fb6e1623aec84165cd94031",
        "c_id": "5dc73a298ce0ed3ec726f0d3",
        "number": 456009,
        "date": "2009-12-11T23:00:00.000Z",
        "status": true,
        "count": 4,
        "price": 18791.48
    },
    {
        "_id": "5fb828d3e6caec60d4434e38",
        "c_id": "5dc73a298ce0ed3ec726f0d3",
        "number": 456010,
        "date": null,
        "status": false,
        "count": 2,
        "price": 8000.88
    },
    {
        "_id": "5fb7b7a6dc90801a6484e1b4",
        "c_id": "5dc73a298ce0ed3ec726f0d3",
        "number": 456010,
        "date": "2009-12-11T23:00:00.000Z",
        "status": false,
        "count": 1,
        "price": 3900.75
    }
]
```

Параметры:<br>
**c_id*** - Идентификатор клиента<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Получение счета

Для получения счёта необходимо отправить **`GET`** запрос на **`/api/invoice_client/:id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5fb6e1623aec84165cd94031",
        "number": 456009,
        "date": "2009-12-11T23:00:00.000Z",
        "status": true,
        "client_name": "Фадеев Руслан",
        "client_company": "ИП Фадеев",
        "count": 4,
        "price": 18791.48,
        "orders": [
            {
                "_id": "5f4611ae46a1250567e99685",
                "price": 3400.56,
                "date": "2020-08-26T10:39:26.392Z",
                "name": "Geely Emgrand EC7 2009-2016"
            },
            {
                "_id": "5fab0010f15ef95b805e7816",
                "price": 4600.32,
                "date": "2020-11-11T00:03:12.312Z",
                "name": "Audi 80 1991-1996"
            },
            {
                "price": 4900,
                "date": "2020-10-21T09:22:53.225Z",
                "_id": "5f8fd3bd82d43918ea429859",
                "name": "Daewoo Nexia 2008-2016"
            },
            {
                "price": 5890.6,
                "date": "2020-02-12T12:39:46.394Z",
                "_id": "5e43c7e2a7b3400f09f2c7d3",
                "name": "Geely Emgrand EC7 2009-2016"
            }
        ],
        "bank": {
            "Название банка": "Филиал «Нижегородский» АО «Альфа-Банк» г. Нижний Новгород",
            "БИК": "42202824",
            "Корреспондентский счёт": "30101810200000000824",
            "Расчётный счёт ": "40802810329170001806"
        },
        "company": {
            "ИНН": "519053684431",
            "Поставщик": "П Бурцев Андрей Владимирович, ИНН 519053684431, 440513, Пензенская обл, Пензенский р-н, Засечное с, Центральная ул, дом №7, кв. 24"
        }
    }
]
```

Параметры:<br>
**id*** - Идентификатор счёта<br>

Ответ:<br> коды состояний 204 или 404.

<br>