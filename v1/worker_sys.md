[Главная](README.md)
<br>
# Система сотрудника
worker_sys.js
<br>
Дизайн: https://xd.adobe.com/view/cca15b9e-7559-4c9d-8981-33d1e19e0f58-99f2/flow

<br>

### Получаем timezone

Для получения timezone необходимо отправить **`GET`** запрос на **`/api/time`**<br>

Пример ответа:<br>
```
[
    Europe/Ljubljana
]
```

<br>

### Получаем имя сотрудника

Для получения имени сотрудника необходимо отправить **`GET`** запрос на **`/api/worker_name/:u_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cbc7c5f03a9c19c2c71e7a9",
        "name": "Алена Болотова"
    }
]
```

Параметры:<br>
**u_id*** - id сотрудника<br>

<br>

### Cотруднику делаем отметку о присудствии на рабочем месте

Что бы сделать отметку о присудствии на рабочем месте необходимо отправить **`PUT`** запрос на **`/api/worker_in`**<br>

Пример отправки параметров:<br>
```
{
    "_id": "5cbc7c5f03a9c19c2c71e7a9",
    "at_work": false
}
```

Параметры:<br>
**_id*** - id сотрудника<br>
**at_work*** - Статус сотрудника, на рабочем месте. При авторизации сотрудника делаем ему статус true, после выхода делаем статус false<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Получение списка заказов для сотрудника, где для него уже активна его операция

Для получения списка заказов необходимо отправить **`GET`** запрос на **`/api/order_worker/:u_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5d134d6165bcca1ed8caa6f6",
        "name": "Ford Focus 2014-2017"
    },
    {
        "_id": "5cee1906a0150d178c0a931d",
        "name": "Ford Focus 2014-2017"
    },
    {
        "_id": "5d134d6065bcca1ed8caa6f5",
        "name": "Ford Focus 2014-2017"
    }
]
```

Параметры:<br>
**u_id*** - id сотрудника<br>

<br>

### Получение заказа для сотрудника, где для него уже активна его операция

Для получения заказа необходимо отправить **`GET`** запрос на **`/order_id_worker/:_id/:u_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "6082644a2cd9d308d907b8f0",
        "order": {
            "auto": {
                "Марка": "KIA",
                "Модель": "Cerato",
                "Поколение": "2013-н.в.",
                "Кузов": "3",
                "Тип кузова вашего автомобиля": "Седан",
                "Есть ли задний подлокотник": "Есть"
            },
            "list": {
                "Дизайн": "Classic",
                "Комплектность": "5 мест",
                "Количество": "1",
                "Основа": {
                    "Материал": "Экокожа Аригон гладкая",
                    "Цвет": "Черный"
                },
                "Центральная вставка": {
                    "Материал": "Велюр",
                    "Цвет": "Бежевый"
                },
                "Отстрочка": "Черный 901"
            },
            "price": 4900,
            "date": "2021-04-23T09:08:10.810Z"
        },
        "worker": {
            "w_id": "5d61a182abf1fe315164d29f",
            "name": "Ruslan Fadeev"
        },
        "s_id": "617a7cee1fa1db23e188a05a",
        "operation": {
            "type": "operation",
            "_id": "617a7a8dce76475c8b90ce7f",
            "relation": {
                "gr": [
                    {
                        "color": "#2EA877",
                        "relation": [
                            {
                                "_id": "617a7b439a2ffa0fb0b72819",
                                "firstPointIndex": 1,
                                "secondPointIndex": 3,
                                "so_id": "617a7abcdf400a2d6daef6ef",
                                "result": "Assembly complete",
                                "bgr_color": "#2EA877",
                                "function": []
                            }
                        ]
                    }
                ],
                "other": []
            }
        },
        "description": {
            "name": "Assembly",
            "description": "Тестирование продукта"
        }
    }
]
```

Параметры:<br>
**_id*** - id заказа<br>
**u_id*** - id сотрудника<br>

<br>

### Получение списка сообщений

Для получения списка сообщений необходимо отправить **`GET`** запрос на **`/api/order_worker_message/:_id`**<br>

Пример ответа:<br>
```
[
    {
        "w_m_id": "5d18ade2a903510d284cb4c3",
        "operation": "Раскройка",
        "worker": "Алена Болотован",
        "w_id": "Тестовое сообщение!",
        "m_data": "24.06.2019 06:24"
    },
    {
        "w_m_id": "5d18b33ea903510d284cb4c5",
        "operation": "ОТК",
        "worker": "Юлия Селянина",
        "w_id": "Ответ на тестовое сообщение!",
        "m_data": "27.06.2019 06:24"
    }
]
```

Параметры:<br>
**_id*** - id заказа<br>

<br>

### Получение данныx по предыдущей операции и связи

Для получения данныx по предыдущей операции и связи необходимо отправить **`GET`** запрос на **`/order_prev_operation/:_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5df00aeafc921d1f988d9228",
        "name_prev_operation": "Тестирование продукта",
        "result_prev_operation": "Готово"
    }
]
```

Параметры:<br>
**_id*** - id заказа<br>

<br>

### Получение технических карт для операции

Для получения технических карт для операции необходимо отправить **`GET`** запрос на **`/order_worker_techmap/:_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "6178503ecb30bb6aa7dc2020",
        "technical_maps": [
            {
                "name": "Tech map",
                "file_name": "car_cover.jpg",
                "file_url": "https://firebasestorage.googleapis.com/v0/b/msa-cloud.appspot.com/o/car_cover.jpg?alt=media&token=a6d2825e-1a6f-4217-b340-9d126bdc0e9b",
                "upload": true
            },
            {
                "name": "Tech map",
                "file_name": "car_cover 2.jpg",
                "file_url": "https://firebasestorage.googleapis.com/v0/b/msa-cloud.appspot.com/o/car_cover%202.jpg?alt=media&token=75a7b848-b346-4d78-aa15-b74edb27f30c",
                "upload": true
            }
        ]
    }
]
```

Параметры:<br>
**_id*** - id операции<br>

<br>

### Создаём новое сообщение

Для получения списка сообщений необходимо отправить **`GET`** запрос на **`/api/order_worker_new_message`**<br>

Пример отправки параметров:<br>
```
{
    "_id": "5d134d6165bcca1ed8caa6f6",
    "u_id": "5ccbfeb65a65c541f061440c",
    "message": "Новое тестовое сообщение!"
}
```

Параметры:<br>
**_id*** - id заказа<br>
**u_id*** - id сотрудника<br>
**message*** - текстовое сообщение<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Начало выполнения операции сотрудником

Для начала выполнеия операции сотрудником необходимо отправить **`PUT`** запрос на **`/api/order_worker_start`**<br>

Пример отправки параметров:<br>
```
{
    "order_id": "5ceb195de3701f58962507b4",
    "stream_id": null,
    "operation_id": "5cbb844a9279efc1c8150a89"
}
```

Параметры:<br>
**order_id*** - Идентификатор заказа<br>
**stream_id*** - Идентификатор вложения текущей оперции, если операция находися во вложении, иначе будет null<br>
**operation_id*** - Идентификатор текущей операции<br>
Для примера: http://prntscr.com/nu1yob<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Выполнение операции сотрудником

Для выполнения операции сотрудником необходимо отправить **`PUT`** запрос на **`/api/order_worker_finish`**<br>

Пример отправки параметров:<br>
```
{
    "order_id": "5ceb195de3701f58962507b4",
    "stream_id": null,
    "next_operation_id": "5cbb8d969279efc1c8150a8f",
    "current_operation_id": "5cbb844a9279efc1c8150a89",
    "relation_id": "5dbacff8ff4d912c565ebce4"
}
```

Параметры:<br>
**order_id*** - Идентификатор заказа<br>
**stream_id*** - Идентификатор вложения текущей оперции, если операция находися во вложении, иначе будет null<br>
**next_operation_id*** - Идентификатор следующей операции ("so_id" из описании связи)<br>
**current_operation_id*** - Идентификатор текущей операции ("o_id")<br>
**relation_id*** - Идентификатор связи по которой перходим<br>
Для примера: http://prntscr.com/nu1yob<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Проверяем не отменёл ли заказ

Для проверки не отменёл ли заказ необходимо отправить **`GET`** запрос на **`/order_worker_active/:_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5e49869a80090a4afa3b3b63"
    }
]
```

Параметры:<br>
**_id*** - id сотрудника<br>

<br>

### Проверяем не разлогинил ли сотрудника администратор

Для проверки не разлогинил ли сотрудника администратор необходимо отправить **`GET`** запрос на **`/worker_logout/:u_id`**<br>

Пример ответа:<br>
```
[
    {
        "at_work": false
    }
]
```

Параметры:<br>
**u_id*** - id сотрудника<br>

<br>

### Сотрудник создаёт новый заказ

Для создания нового заказа необходимо отправить **`POST`** запрос на **`/worker_new_order_pending`**<br>

Пример отправки параметров:<br>
```
{
   "name": "Details 1 delivery",
   "composition": {
        "What to deliver?": "Detail 1",
        "Detail id": "61f5b6541f1d04747fffe837",
        "Workplace": "D360",
        "Worker": "Denis Ivanov",
        "Worker id": "61f5b6541f1d04487gkde639"
    }
}
```

Параметры:<br>
**name*** - Имя заказа<br>
**composition*** - Состав заказа<br>

Ответ:<br> коды состояний 200 (id созданного заказа) или 404.

<br>

### Сотрудник отправляет заказ на исполнение

Для отправки заказа на исполнение необходимо отправить **`POST`** запрос на **`/worker_order_execution`**<br>

Пример отправки параметров:<br>
```
{
    "_id": "61fa5b0817e8e50c74e54549",
    "s_id": "61af20b86c76af54179464b9"
}
```

Параметры:<br>
**_id*** - идентификатор заказа<br>
**s_id*** - идентификатор потока<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Добавление сотрудника к выполнению заказа

Для добавления сотрудника к исполнению заказа необходимо отправить **`PUT`** запрос на **`/worker_order_worker_add`**<br>

Пример отправки параметров:<br>
```
{
	"_id": "61fa5b0817e8e50c74e54549",
    "worker":
    {
     "o_id": "6196c543e60e7b7dd9d30585",
     "w_id": "6178503ecb30bb6aa7dc2020",
     "name": "Екатерина Юхачева2"
    }
}
```

Параметры:<br>
**_id*** - идентификатор заказа<br>
**o_id*** - идентификатор операции<br>
**w_id*** - идентификатор сотрудника<br>
**name*** - имя сотрудника<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Проверяем условия для отображения связи

Для проверки условия для отображения связи необходимо отправить **`GET`** запрос на **`/condition_result/:_id/:r_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "630b329128a7fd7412b494c3",
        "relation_res": [
            false,
            true,
            true
        ],
        "relation": false
    }
]
```

Параметры:<br>
**_id*** - id заказа<br>
**r_id*** - id связи<br>

<br>


