[Главная](README.md)
<br>
# Система менеджера
manager_sys.js
<br>
Дизайн: https://xd.adobe.com/spec/f8ced5c5-a5a2-43fd-6b9b-72c3830ef1cf-8eff/

<br>

### Получение имени менеджера

Для получения имени менеджера необходимо отправить **`GET`** запрос на **`/api/manager_name/:u_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cf936d3792e90f84ad8d39b",
        "name": "Иван Петров"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор менеджера<br>

<br>

### Получение клиентов менеджера

Для получения клиентов менеджера необходимо отправить **`GET`** запрос на **`/manager_client/:u_id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cd6acd4ca9472beaa183775",
        "name": "Любовь Миланова"
    },
    {
        "_id": "5ced92723e91ffd8f8328224",
        "name": "Жихарев Сергей"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор менеджера<br>

<br>

### Получение списка заказов, статус "в ожидании" (так же для поиска)

Для получения списка заказов, статус "в ожидании" необходимо отправить **`GET`** запрос на **`/api/manager_order_pending/:u_id/:brand/:model/:generation/:client/:first_date/:second_date`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cd8279ecdfee493715d37de",
        "name": "Ford Focus 2014-2017",
        "get_date": "12.05.2019 14:03:10",
        "m_m_flag": false,
        "status": "в ожидании",
        "count": 3,
        "client": "Любовь Миланова"
    },
    {
        "_id": "5cfd4edd631521e4d7b0fd8a",
        "name": "Ford Focus 2014-2017",
        "get_date": "09.06.2019 18:24:29",
        "status": "в ожидании",
        "count": 1,
        "client": "Любовь Миланова"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор менеджера<br>
**brand*** - Марка автомобиля<br>
**model*** - Модель автомобиля<br>
**generation*** - Поколение автомобиля<br>
**client*** - Идентификатор клиента<br>
**first_date*** - Нижняя граница даты поиска<br>
**second_date*** - Верхняя граница даты поиска<br>

<br>

### Получение заказа, статус "в ожидании"

Для получения заказа, статус "в ожидании", необходимо отправить **`GET`** запрос на **`/api/manager_id_order_pending/:id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cd8279ecdfee493715d37de",
        "status": "pending",
        "auto": {
            "Марка": "Ford",
            "Модель": "Focus",
            "Поколение": "2014-2017",
            "Сложность": 3,
            "Какая конструкция передних подлокотников?": "Прямая"
        },
        "list": {
            "Количество": 3,
            "Тип задней спинки": "60x40",
            "Дизайн": "Classic",
            "Основной цвет": "Бежевый (Крем)",
            "Цвет боковых поддержек": "Белый",
            "Цвет декоративной отстрочки": "Серый 1615",
            "Материал центральной вставки": "Жаккард",
            "Цвет центральной вставкии": "Бежево-серый",
            "Вышивка логотипа": "нет",
            "Цвет логотипа": "нет",
            "Отстрочка центральной части": "Соты 45",
            "Цвет отстрочки центральной части": "Синий 575",
            "Комментарий": "Небольшое описание заказа"
        },
        "mc_message": {
            "m_m_flag": false,
            "c_m_flag": false,
            "message": [
                {
                    "mc_m_id": "5ce1c950ab9d9ce84d23c147",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "manager",
                    "message": "Какая точная комплектация вашего автомобиля?"
                },
                {
                    "mc_m_id": "5ce1cc17ab9d9ce84d23c148",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "client",
                    "message": "Комплектация Sport"
                },
                {
                    "mc_m_id": "5ce1cce7ab9d9ce84d23c149",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "manager",
                    "message": "Спасибо! Отдаю в работу!"
                }
            ]
        },
        "c_id": "5cd6acd4ca9472beaa183775",
        "date": "2019-05-12T14:03:10.056Z"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>

<br>

### Получение списка заказов, статус "в работе" (так же для поиска)

Для получения списка заказов, статус "в работе" необходимо отправить **`GET`** запрос на **`/api/manager_order_active/:u_id/:brand/:model/:generation/:client/:stream/:date_filter/:first_date/:second_date`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cee18c1a0150d178c0a9317",
        "name": "Ford Focus 2014-2017",
        "get_date": "29.05.2019 05:29:37",
        "start_date": "29.05.2019 05:30:44",
        "count": 12,
        "client": "Любовь Миланова",
        "stream": "Комплект авточехлов",
        "status": "в работе"
    },
    {
        "_id": "5ced68c35fb188a6d2cfe500",
        "name": "Ford Focus 2014-2017",
        "get_date": "28.05.2019 16:58:43",
        "start_date": "28.05.2019 16:58:56",
        "count": 10,
        "client": "Любовь Миланова",
        "stream": "Комплект авточехлов",
        "status": "в работе"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор менеджера<br>
**brand*** - Марка автомобиля<br>
**model*** - Модель автомобиля<br>
**generation*** - Поколение автомобиля<br>
**client*** - Идентификатор клиента<br>
**stream*** - Идентификатор потока<br>
**date_filter*** - Спискок по степени готовности заказа (Поступление ('get_date'), Передача в работу ('start_date'))<br>
**first_date*** - Нижняя граница даты поиска<br>
**second_date*** - Верхняя граница даты поиска<br>

<br>

### Получение заказа, статус "в работе"

Для получения заказа, статус "в работе", необходимо отправить **`GET`** запрос на **`/api/manager_id_order_active/:id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cd8279ecdfee493715d37de",
        "status": "pending",
        "auto": {
            "Марка": "Ford",
            "Модель": "Focus",
            "Поколение": "2014-2017",
            "Сложность": 3,
            "Какая конструкция передних подлокотников?": "Прямая"
        },
        "list": {
            "Количество": 3,
            "Тип задней спинки": "60x40",
            "Дизайн": "Classic",
            "Основной цвет": "Бежевый (Крем)",
            "Цвет боковых поддержек": "Белый",
            "Цвет декоративной отстрочки": "Серый 1615",
            "Материал центральной вставки": "Жаккард",
            "Цвет центральной вставкии": "Бежево-серый",
            "Вышивка логотипа": "нет",
            "Цвет логотипа": "нет",
            "Отстрочка центральной части": "Соты 45",
            "Цвет отстрочки центральной части": "Синий 575",
            "Комментарий": "Небольшое описание заказа"
        },
        "mc_message": {
            "m_m_flag": false,
            "c_m_flag": false,
            "message": [
                {
                    "mc_m_id": "5ce1c950ab9d9ce84d23c147",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "manager",
                    "message": "Какая точная комплектация вашего автомобиля?"
                },
                {
                    "mc_m_id": "5ce1cc17ab9d9ce84d23c148",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "client",
                    "message": "Комплектация Sport"
                },
                {
                    "mc_m_id": "5ce1cce7ab9d9ce84d23c149",
                    "m_date": "2019-05-12T14:03:10.056Z",
                    "who": "manager",
                    "message": "Спасибо! Отдаю в работу!"
                }
            ]
        },
        "c_id": "5cd6acd4ca9472beaa183775",
        "date": "2019-05-12T14:03:10.056Z"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>

<br>

### Получение списка заказов, статус "выполнен" (так же для поиска)

Для получения списка заказов, статус "выполнен" необходимо отправить **`GET`** запрос на **`/api/manager_order_complete/:u_id/:id/:brand/:model/:generation/:client/:stream/:date_filter/:first_date/:second_date`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cee18c1a0150d178c0a9317",
        "name": "Ford Focus 2014-2017",
        "get_date": "29.05.2019 05:29",
        "start_date": "29.05.2019 05:30",
        "finish_date": "23.06.2019 08:00",
        "client": "Любовь Миланова",
        "stream": "Комплект авточехлов",
        "sub_order": [
            {
                "_id": "5cee1907a0150d178c0a9321",
                "name": "Ford Focus 2014-2017",
                "client": "Любовь Миланова",
                "stream": "Комплект авточехлов",
                "get_date": "29.05.2019 05:29",
                "start_date": "29.05.2019 05:30",
                "finish_date": "23.06.2019 08:00",
                "status": "выполнен"
            },
            {
                "_id": "5cee1906a0150d178c0a931d",
                "name": "Ford Focus 2014-2017",
                "client": "Любовь Миланова",
                "stream": "Комплект авточехлов",
                "get_date": "29.05.2019 05:29",
                "start_date": "29.05.2019 05:30",
                "finish_date": "23.06.2019 08:01",
                "status": "выполнен"
            }
        ],
        "count": 12,
        "status": "выполнен частично",
        "progress": "выполнен на33%"
    },
    {
        "_id": "5cfa1e8830500267c139e7ab",
        "name": "Ford Focus 2014-2017",
        "get_date": "07.06.2019 08:21",
        "start_date": "07.06.2019 08:22",
        "finish_date": "07.06.2019 08:22",
        "client": "Любовь Миланова",
        "stream": "Комплект авточехлов",
        "count": 1,
        "status": "выполнен"
    },
    {
        "_id": "5cf4169ad3da7ae9901df605",
        "name": "Ford Focus 2014-2017",
        "get_date": "02.06.2019 18:34",
        "start_date": "02.06.2019 18:34",
        "finish_date": "02.06.2019 18:34",
        "client": "Любовь Миланова",
        "stream": "Комплект авточехлов",
        "count": 1,
        "status": "выполнен"
    }
]
```

Параметры:<br>
**u_id*** - Идентификатор менеджера<br>
**id*** - Идентификатор заказа<br>
**brand*** - Марка автомобиля<br>
**model*** - Модель автомобиля<br>
**generation*** - Поколение автомобиля<br>
**client*** - Идентификатор клиента<br>
**stream*** - Идентификатор потока<br>
**date_filter*** - Спискок по степени готовности заказа (Поступление ('get_date'), Передача в работу ('start_date'))<br>
**first_date*** - Нижняя граница даты поиска<br>
**second_date*** - Верхняя граница даты поиска<br>

<br>

### Получение заказа, статус "выполнен"

Для получения заказа, статус "выполнен", необходимо отправить **`GET`** запрос на **`/api/manager_id_order_complete/:id`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cfa74e0000bf58b520fca7a",
        "status": "active",
        "auto": {
            "Марка": "Ford",
            "Модель": "Focus",
            "Поколение": "2014-2017",
            "Сложность": "3",
            "Какая конструкция передних подлокотников?": "Прямая"
        },
        "list": {
            "Дизайн": "Classic",
            "Индивидуальный дизайн": "Да",
            "Основной материал": "Экозамша",
            "Основной материал цвет": "Красный",
            "Материал боковых поддержек": "Экозамша",
            "Материал боковых поддержек цвет": "Красный",
            "Материал центральной вставки": "Экозамша",
            "Материал центральной вставки цвет": "Красный",
            "Цвет декоративной отстрочки": "Красный",
            "Место вышивки логотипа": "На подголовнике",
            "Логотип цвет": "На подголовнике",
            "Нестандартный логотип": "Да",
            "Стёжка центральной части": "Анаконда",
            "Стёжка центральной части цвет": "Да",
            "Комплектность": "Задний подголовник",
            "Количество": 2,
            "Комментарий": "Небольшое описание заказа"
        },
        "c_id": "5cd6acd4ca9472beaa183775",
        "get_date": "2019.06.07 14:29:52:547",
        "start_date": "2019.06.07 14:30:23:689",
        "finish_date": "2019.05.21 19:35:42:263"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>

<br>

### Получение cписка потоков

Для получения списка потоков необходимо отправить **`GET`** запрос на **`/api/manager_stream`**<br>

Пример ответа:<br>
```
[
    {
        "_id": "5cbcd9301210f9ac962905d9",
        "name": "Комплект авточехлов"
    },
    {
        "_id": "5cbcd9301210f9ac962906d7",
        "name": "Тест"
    }
]
```

<br>

### Отправка заказа в работу

Для отправки заказа в работу необходимо отправить **`POST`** запрос на **`/api/order`**<br>

Пример отправки параметров:<br>
```
{
    "_id": "5cf4169ad3da7ae9901df605",
    "s_id": "5cbcd9301210f9ac962905d9"
}
```

<br>

### Получение переписки менеджера - клиента для заказа

Для получения переписки необходимо отправить **`GET`** запрос на **`/api/manager_order_message/:id/:status`**<br>

Пример ответа:<br>
```
[
    {
        "mc_m_id": "5ce1c950ab9d9ce84d23c147",
        "who": "manager",
        "message": "Какая точная комплектация вашего автомобиля?",
        "date": "2019.05.12 14:03:10"
    },
    {
        "mc_m_id": "5ce1cc17ab9d9ce84d23c148",
        "who": "client",
        "message": "Комплектация Sport",
        "date": "2019.05.12 14:03:10"
    },
    {
        "mc_m_id": "5ce1cce7ab9d9ce84d23c149",
        "who": "manager",
        "message": "Спасибо! Отдаю в работу!",
        "date": "2019.05.12 14:03:10"
    }
]
```

Параметры:<br>
**id*** - Идентификатор заказа<br>
**status*** - Cтатус заказа (pending, active, canceled, complete)<br>

<br>

### Создание нового cообщения менеджера - клиента для заказа

Для создания нового заказа необходимо отправить **`POST`** запрос на **`/api/manager_order_message`**<br>

Пример отправки параметров:<br>
```
{
    "id": "5cd8279ecdfee493715d37de",
    "status": "pending",
    "message": "Тестовое сообщение!"
}
```

Параметры:<br>
**id*** - Идентификатор заказа<br>
**status*** - Cтатус заказа (pending, active, canceled, complete)<br>
**message*** - Текст сообщения<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Редактирование заказа

Для редактирования заказа необходимо отправить **`PUT`** запрос на **`/api/order_pending`**<br>

Пример отправки параметров:<br>
```
{
    "_id": "5e77ca9262922308d53b3015",
    "list":
    {
	   "Дизайн": "Classic",
	   "Комплектность": "Задний подголовник",
	   "Количество": 1,
	   "Основа": 
	     { 
	       "материал": "Экозамша",
	       "цвет": "Красный"
	     },
	   "Боковые поддержки": 
	     { 
	       "материал": "Экозамша",
	       "цвет": "Красный"
	     },
	   "Центральная вставка": 
	     { 
	       "материал": "Экозамша",
	       "цвет": "Красный"
	     },
	  "Отстрочка": "Красный",
	  "Логотип": 
	     { 
	       "тип": "Нестандартный логотип",
	       "место": "На подголовнике",
	       "цвет": "Красный"
	     },
	  "Стёжка": 
	     { 
	       "рисунок": "Анаконда",
	       "цвет": "Красный",
	       "доп": "Стёжка на подголовниках,"
	     },
	  "Комментарий менеджеру": "Небольшое описание заказа, Не добавлять поролон"
	}
}
```

Параметры:<br>
**_id*** - Идентификатор заказа<br>
**list*** - Обновлённые параметры заказа<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Удаление заказа, статус "в ожидании"

Для создания нового заказа необходимо отправить **`DELETE`** запрос на **`/api/manager_order_pending/:id`**<br>

Параметры:<br>
**id*** - Идентификатор заказа<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Указание срочности заказа, который находится в ожидании

Для указания срочности заказа, который находится в ожидании, необходимо отправить **`PUT`** запрос на **`/api/manager_order_pending_urgently`**<br>

Пример отправки параметров:<br>
```
{
	"_id": "5f97bd125ce64c239f4b14f0",
    "urgently": true
}
```

Параметры:<br>
**_id*** - Идентификатор заказа<br>
**urgently*** - Срочность заказа true или false<br>

Ответ:<br> коды состояний 204 или 404.

<br>

### Указание срочности заказа, который находится в работе

Для указания срочности заказа, который находится в работе, необходимо отправить **`PUT`** запрос на **`/api/manager_order_urgently`**<br>

Пример отправки параметров:<br>
```
{
	"_id": "5f97bd125ce64c239f4b14f0",
    "urgently": true
}
```

Параметры:<br>
**_id*** - Идентификатор заказа<br>
**urgently*** - Срочность заказа true или false<br>

Ответ:<br> коды состояний 204 или 404.

<br>